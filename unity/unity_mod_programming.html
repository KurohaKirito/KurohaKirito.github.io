<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.0.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/icon/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/icon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/icon/favicon-16x16.png">
  <link rel="mask-icon" href="/images/icon/logo.svg" color="#222">
  <meta name="google-site-verification" content="UtyDAPkH1wac_9oyOpkJSRJ1JE7hPHvMFl9d2jPe5cQ">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" integrity="sha256-yIDrPSXHZdOZhAqiBP7CKzIwMQmRCJ8UeB8Jo17YC4o=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.28/fancybox/fancybox.css" integrity="sha256-6cQIC71/iBIYXFK+0RHAvwmjwWzkWd+r7v/BX3/vZDc=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"kuroha.vip","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.19.1","exturl":true,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"width":280},"copycode":{"enable":true,"style":"mac"},"fold":{"enable":false,"height":500},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"buttons","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":false,"async":true,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="Unity 游戏的模组支持开发总结">
<meta property="og:type" content="article">
<meta property="og:title" content="Unity 游戏的模组支持开发总结">
<meta property="og:url" content="https://kuroha.vip/unity/unity_mod_programming.html">
<meta property="og:site_name" content="二次元游宅客">
<meta property="og:description" content="Unity 游戏的模组支持开发总结">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://kuroha.vip/images/unity/mod_data.png">
<meta property="og:image" content="https://kuroha.vip/images/unity/mod-sdk-0.png">
<meta property="og:image" content="https://kuroha.vip/images/unity/mod-sdk-1.png">
<meta property="og:image" content="https://kuroha.vip/images/unity/mod-sdk-2.png">
<meta property="og:image" content="https://kuroha.vip/images/unity/mod-sdk-3.png">
<meta property="og:image" content="https://kuroha.vip/images/unity/mod-sdk-4.png">
<meta property="og:image" content="https://kuroha.vip/images/unity/mod-sdk-5.png">
<meta property="og:image" content="https://kuroha.vip/images/unity/mod-sdk-6.png">
<meta property="og:image" content="https://kuroha.vip/images/unity/mod-sdk-7.png">
<meta property="og:image" content="https://kuroha.vip/images/unity/mod-sdk-8.png">
<meta property="og:image" content="https://kuroha.vip/images/unity/mod-sdk-9.png">
<meta property="og:image" content="https://kuroha.vip/images/unity/mod-sdk-10.png">
<meta property="og:image" content="https://kuroha.vip/images/unity/mod-sdk-11.png">
<meta property="og:image" content="https://kuroha.vip/images/unity/mod-sdk-12.png">
<meta property="article:published_time" content="2025-05-13T14:50:49.000Z">
<meta property="article:modified_time" content="2025-06-12T11:57:58.207Z">
<meta property="article:author" content="Kuroha">
<meta property="article:tag" content="Mod">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://kuroha.vip/images/unity/mod_data.png">


<link rel="canonical" href="https://kuroha.vip/unity/unity_mod_programming.html">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://kuroha.vip/unity/unity_mod_programming.html","path":"unity/unity_mod_programming.html","title":"Unity 游戏的模组支持开发总结"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Unity 游戏的模组支持开发总结 | 二次元游宅客</title>
  









    <script>
        (function () {
            if ('') {
                var str = prompt('😈 私密日记, 查看请输入密码!');
                if (str == "" || str == null) {
                    history.back();
                } else if (str !== '') {
                    alert('😥 这个密码好像不太对, 再试试...');
                    history.back();
                }
            }
        })();
    </script>


<!--动漫菜单-->

    <link rel="stylesheet" href="/js/galmenu/css/GalMenu.css">


  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">二次元游宅客</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">一个热爱二次元和游戏开发的宅极客!</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">57</span></a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">26</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">11</span></a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-捉小猫游戏"><a href="/catch_cat/" rel="section"><i class="fa fa-cat fa-fw"></i>捉小猫游戏</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%F0%9F%90%AC%E5%89%8D%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">🐬前言</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%F0%9F%90%A4%E4%B8%BA%E6%A8%A1%E7%BB%84%E6%B7%BB%E5%8A%A0-%E8%B5%84%E6%BA%90%E6%A8%A1%E5%9D%97-%E6%94%AF%E6%8C%81"><span class="nav-number">2.</span> <span class="nav-text">🐤为模组添加 &quot;资源模块&quot; 支持</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%F0%9F%A4%A0%E6%9C%AC%E4%BD%93%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E6%A0%BC%E5%BC%8F%E9%80%89%E6%8B%A9-ScriptableObject"><span class="nav-number">3.</span> <span class="nav-text">🤠本体数据库的格式选择: ScriptableObject</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%F0%9F%92%8A%E6%A8%A1%E7%BB%84%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E6%A0%BC%E5%BC%8F%E9%80%89%E6%8B%A9-Json"><span class="nav-number">4.</span> <span class="nav-text">💊模组数据库的格式选择: Json</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%F0%9F%8D%93%E5%AE%9E%E7%8E%B0%E8%B5%84%E6%BA%90%E6%A8%A1%E5%9D%97%E7%9A%84%E8%BF%87%E7%A8%8B"><span class="nav-number">5.</span> <span class="nav-text">🍓实现资源模块的过程</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%AC%E4%BD%93-%E7%BC%96%E5%86%99%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F"><span class="nav-number">5.1.</span> <span class="nav-text">本体: 编写数据库管理系统</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BB%9F%E5%90%88%E7%AE%A1%E7%90%86%E5%99%A8"><span class="nav-number">5.1.1.</span> <span class="nav-text">数据库统合管理器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%A2%97%E7%B2%92%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E5%8A%A0%E8%BD%BD%E9%80%BB%E8%BE%91"><span class="nav-number">5.1.2.</span> <span class="nav-text">颗粒数据库的加载逻辑</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%AC%E5%9C%B0-%E6%8B%86%E5%88%86%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="nav-number">5.2.</span> <span class="nav-text">本地: 拆分数据结构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%AC%E5%9C%B0-%E8%B5%84%E6%BA%90%E6%A0%87%E8%AF%86%E8%A7%84%E8%8C%83%E5%8C%96"><span class="nav-number">5.3.</span> <span class="nav-text">本地: 资源标识规范化</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9E%9A%E4%B8%BE"><span class="nav-number">5.3.1.</span> <span class="nav-text">枚举</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E5%AD%97"><span class="nav-number">5.3.2.</span> <span class="nav-text">数字</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="nav-number">5.3.3.</span> <span class="nav-text">字符串</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AF%AD%E4%B9%89%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="nav-number">5.3.4.</span> <span class="nav-text">语义字符串</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A8%A1%E7%BB%84-%E6%B7%BB%E5%8A%A0%E8%AF%AD%E6%B3%95%E6%96%87%E4%BB%B6%E8%A7%A3%E6%9E%90"><span class="nav-number">5.4.</span> <span class="nav-text">模组: 添加语法文件解析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A8%A1%E7%BB%84-%E6%B7%BB%E5%8A%A0%E5%9B%BE%E7%89%87%E5%92%8C%E9%9F%B3%E4%B9%90%E5%A4%96%E9%83%A8%E5%8A%A0%E8%BD%BD%E6%94%AF%E6%8C%81"><span class="nav-number">5.5.</span> <span class="nav-text">模组: 添加图片和音乐外部加载支持</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%BC%E5%85%A5%E5%9B%BE%E7%89%87%E6%94%AF%E6%8C%81"><span class="nav-number">5.5.1.</span> <span class="nav-text">导入图片支持</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%BC%E5%85%A5%E9%9F%B3%E9%A2%91%E6%94%AF%E6%8C%81"><span class="nav-number">5.5.2.</span> <span class="nav-text">导入音频支持</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%F0%9F%8D%89%E4%B8%BA%E6%B8%B8%E6%88%8F%E6%B7%BB%E5%8A%A0-%E7%BC%96%E7%A8%8B%E6%A8%A1%E7%BB%84-%E6%94%AF%E6%8C%81"><span class="nav-number">6.</span> <span class="nav-text">🍉为游戏添加 &quot;编程模组&quot; 支持</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E5%8A%A0%E8%BD%BD%E6%A8%A1%E7%BB%84%E4%BD%9C%E8%80%85-DLL-%E4%B8%AD%E7%9A%84%E9%80%BB%E8%BE%91"><span class="nav-number">6.1.</span> <span class="nav-text">如何加载模组作者 DLL 中的逻辑</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#json-%E6%96%B9%E6%A1%88"><span class="nav-number">6.1.1.</span> <span class="nav-text">json 方案</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%8D%E5%B0%84%E6%96%B9%E6%A1%88"><span class="nav-number">6.1.2.</span> <span class="nav-text">反射方案</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%89%B9%E6%80%A7%E6%96%B9%E6%A1%88"><span class="nav-number">6.1.3.</span> <span class="nav-text">特性方案</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BF%85%E9%A1%BB%E5%AE%9E%E7%8E%B0%E7%9A%84%E9%80%BB%E8%BE%91"><span class="nav-number">6.1.4.</span> <span class="nav-text">必须实现的逻辑</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E7%BB%99%E4%BA%88%E6%A8%A1%E7%BB%84%E4%BD%9C%E8%80%85-DLL-%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83"><span class="nav-number">6.2.</span> <span class="nav-text">如何给予模组作者 DLL 开发环境</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A3%B0%E6%98%8E%E5%BC%8F%E7%A8%8B%E5%BA%8F%E9%9B%86"><span class="nav-number">6.3.</span> <span class="nav-text">声明式程序集</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E7%94%9F%E6%88%90%E5%A3%B0%E6%98%8E%E5%BC%8F%E7%A8%8B%E5%BA%8F%E9%9B%86"><span class="nav-number">6.4.</span> <span class="nav-text">如何生成声明式程序集</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A3%B0%E6%98%8E%E5%BC%8F%E7%A8%8B%E5%BA%8F%E9%9B%86%E7%94%9F%E6%88%90%E6%AD%A5%E9%AA%A4"><span class="nav-number">6.5.</span> <span class="nav-text">声明式程序集生成步骤</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83"><span class="nav-number">6.5.1.</span> <span class="nav-text">安装开发环境</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B0%E5%BB%BA%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="nav-number">6.5.2.</span> <span class="nav-text">新建解决方案</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E9%BB%98%E8%AE%A4%E9%A1%B9%E7%9B%AE"><span class="nav-number">6.5.3.</span> <span class="nav-text">删除默认项目</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B0%E5%BB%BA-Unity-%E9%A1%B9%E7%9B%AE"><span class="nav-number">6.5.4.</span> <span class="nav-text">新建 Unity 项目</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%86-Unity-%E4%B8%AD%E7%9A%84%E4%BB%A3%E7%A0%81%E6%8B%B7%E8%B4%9D%E5%88%B0%E5%AF%B9%E5%BA%94%E7%9A%84%E9%A1%B9%E7%9B%AE%E4%B8%AD"><span class="nav-number">6.5.5.</span> <span class="nav-text">将 Unity 中的代码拷贝到对应的项目中</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%95%E5%85%A5%E4%BE%9D%E8%B5%96%E7%9A%84-Unity-%E7%B1%BB%E5%BA%93%E5%92%8C%E7%AC%AC%E4%B8%89%E6%96%B9%E6%8F%92%E4%BB%B6%E5%BA%93"><span class="nav-number">6.5.6.</span> <span class="nav-text">引入依赖的 Unity 类库和第三方插件库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3%E9%A1%B9%E7%9B%AE%E9%97%B4%E7%9A%84%E4%BE%9D%E8%B5%96%E9%97%AE%E9%A2%98"><span class="nav-number">6.5.7.</span> <span class="nav-text">解决项目间的依赖问题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%BE%E5%AE%9A%E8%AF%AD%E8%A8%80%E7%89%88%E6%9C%AC"><span class="nav-number">6.5.8.</span> <span class="nav-text">设定语言版本</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%BE%E5%AE%9A%E7%94%9F%E6%88%90%E5%A3%B0%E6%98%8E%E5%BC%8F%E7%A8%8B%E5%BA%8F%E9%9B%86"><span class="nav-number">6.5.9.</span> <span class="nav-text">设定生成声明式程序集</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%BE%E5%AE%9A%E7%94%9F%E6%88%90%E5%A3%B0%E6%98%8E%E5%BC%8F%E7%A8%8B%E5%BA%8F%E9%9B%86%E7%9A%84%E8%BE%93%E5%87%BA%E7%9B%AE%E5%BD%95"><span class="nav-number">6.5.10.</span> <span class="nav-text">设定生成声明式程序集的输出目录</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A1%A5%E5%85%85%E7%BC%96%E8%AF%91%E5%AE%8F"><span class="nav-number">6.5.11.</span> <span class="nav-text">补充编译宏</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E2%9A%A1%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E5%92%8C-Unity-%E4%B8%AD%E7%9A%84%E7%A8%8B%E5%BA%8F%E9%9B%86%E5%88%92%E5%88%86%E4%BF%9D%E6%8C%81%E4%B8%80%E8%87%B4"><span class="nav-number">7.</span> <span class="nav-text">⚡为什么要和 Unity 中的程序集划分保持一致 ?</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B0%9D%E8%AF%95%E8%A7%A3%E5%86%B3%E4%B8%8B"><span class="nav-number">7.1.</span> <span class="nav-text">尝试解决下 ?</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%82%A3%E6%80%8E%E4%B9%88%E5%8A%9E"><span class="nav-number">7.2.</span> <span class="nav-text">那怎么办 ?</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Kuroha"
      src="/images/about/avatar.gif">
  <p class="site-author-name" itemprop="name">Kuroha</p>
  <div class="site-description" itemprop="description">本人是一个热爱二次元和游戏开发的宅极客, 这是我的个人博客! 主要记录我学习的经历以及自己喜欢的动漫, 音乐, 偶尔也会写一些异想天开的脑洞, 哈哈!</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">57</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">26</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly90Lm1lL0t1cm9oYUtpcml0bw==" title="Telegram → https:&#x2F;&#x2F;t.me&#x2F;KurohaKirito"><i class="fab fa-telegram fa-fw"></i>Telegram</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9zdGVhbWNvbW11bml0eS5jb20vcHJvZmlsZXMvNzY1NjExOTgzOTQxNDcwMDUv" title="Steam → https:&#x2F;&#x2F;steamcommunity.com&#x2F;profiles&#x2F;76561198394147005&#x2F;"><i class="fab fa-steam fa-fw"></i>Steam</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="bWFpbHRvOmt1cm9oYWtpcml0b0BnbWFpbC5jb20=" title="E-Mail → mailto:kurohakirito@gmail.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0t1cm9oYUtpcml0bw==" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;KurohaKirito"><i class="fab fa-github fa-fw"></i>GitHub</span>
      </span>
  </div>


    <div>
        <canvas id="canvasDiyBlock" style="width:60%;">您的浏览器不支持 Canvas, 请更换浏览器!</canvas>
        <script type="text/javascript" src="/js/clock.js"></script>
    </div>


        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
    <div class="sidebar-inner sidebar-blogroll">
      <div class="links-of-blogroll animated">
        <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
          链接
        </div>
        <ul class="links-of-blogroll-list">
            <li class="links-of-blogroll-item">
              <span class="exturl" data-url="aHR0cHM6Ly9zaHlhcmNoZXIuZ2l0aHViLmlvLw==" title="https:&#x2F;&#x2F;shyarcher.github.io&#x2F;">ShyArcher</span>
            </li>
        </ul>
      </div>
    </div>
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://kuroha.vip/unity/unity_mod_programming.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/about/avatar.gif">
      <meta itemprop="name" content="Kuroha">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="二次元游宅客">
      <meta itemprop="description" content="本人是一个热爱二次元和游戏开发的宅极客, 这是我的个人博客! 主要记录我学习的经历以及自己喜欢的动漫, 音乐, 偶尔也会写一些异想天开的脑洞, 哈哈!">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Unity 游戏的模组支持开发总结 | 二次元游宅客">
      <meta itemprop="description" content="Unity 游戏的模组支持开发总结">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Unity 游戏的模组支持开发总结
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-05-13 22:50:49" itemprop="dateCreated datePublished" datetime="2025-05-13T22:50:49+08:00">2025-05-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-06-12 19:57:58" itemprop="dateModified" datetime="2025-06-12T19:57:58+08:00">2025-06-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Mod/" itemprop="url" rel="index"><span itemprop="name">Mod</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>7.2k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>26 分钟</span>
    </span>
</div>

            <div class="post-description">Unity 游戏的模组支持开发总结</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><span id="more"></span>

<h1 id="🐬前言"><a href="#🐬前言" class="headerlink" title="🐬前言"></a>🐬前言</h1><p>模组支持的核心需求主要包含以下两部分:</p>
<ul>
<li><strong>资源模块</strong>: 允许模组作者修改&#x2F;新增游戏配置, 包括角色, 技能, 道具等</li>
<li><strong>编程模块</strong>: 允许模组作者通过脚本扩展游戏逻辑</li>
</ul>
<p>本篇自然以我开发的《魔剑镇魂曲重制版》为例, 因为我也只是一个新手菜鸟, 这次的目标便是完整地实现上述两方面功能即可</p>
<h1 id="🐤为模组添加-资源模块-支持"><a href="#🐤为模组添加-资源模块-支持" class="headerlink" title="🐤为模组添加 &quot;资源模块&quot; 支持"></a>🐤为模组添加 &quot;资源模块&quot; 支持</h1><p>这一部分的思路其实非常简单, 就是游戏内指定一种文本语法, 让模组作者使用这种语法编写配置文本文件, 我们在游戏中按照对应的语法格式读取文本文件, 并添加到游戏数据库中即可</p>
<p>注: 这里的数据库并不是网站开发中的数据库, 而是指游戏内的静态数据, 其实这才是数据库一词的真实含义, 一个完全静态数据的集合就是数据库</p>
<h1 id="🤠本体数据库的格式选择-ScriptableObject"><a href="#🤠本体数据库的格式选择-ScriptableObject" class="headerlink" title="🤠本体数据库的格式选择: ScriptableObject"></a>🤠本体数据库的格式选择: ScriptableObject</h1><p>我这里使用了 Unity 提供的 ScriptableObject, 为什么使用这个呢?</p>
<p>传统的数据配置大多使用 Excel, 充分利用 Excel 那丰富的表格功能, 最大程度提升策划们的工作效率, 同时也提升其他人的阅读效率, 但是 Excel 无法参与 Git 版本管理, 因此大多项目组会将 Excel 文件视为源文件, 真正参与到项目中的是 Excel 导出的 CSV 文件, 这是一种纯粹的带语法格式的文本文件, 虽然语法格式就是简单的用 tab 分割, 但这也是一种语法格式, 这样的 CSV 就可以参与到项目管理中了, Excel 则被纳入了项目外的单独管理中</p>
<p>但实际情况是, 我的项目很小, 从头到尾仅有我一人进行开发, 全部的任务都由我一人完成, 没有其他的阅读者和协作者, 因此保证我的开发效率才是最重要的, 而且使用 Excel 还要编写 Excel 到 CSV 和 CSV 到 Excel 的自动化转化逻辑, 这部分对于我这个单人项目而言, 完全没必要</p>
<p>按照这个思路下去, 最优的选择自然就是 Unity 原生支持的 ScriptableObject 了, 我还可以很方便快速地编写 C# 脚本进行批处理, 这种效率可不是 Excel 能比的 (因为我使用 Excel 并不熟练, 只会基础操作)</p>
<p>还有一个更重要的点, 使用 csv 文件还需要编写对应的 csv 解析逻辑, 不仅如此, 还得写一个对应的数据类, 将 csv 中的数据读取到数据类中, 但是既然都需要编写数据类了, 那为什么不直接将这个数据类继承自 ScriptableObject 呢, 这样都不需要编写解析逻辑了, 直接通过 Unity 读取 ScriptableObject 即可, 一步到位!</p>
<h1 id="💊模组数据库的格式选择-Json"><a href="#💊模组数据库的格式选择-Json" class="headerlink" title="💊模组数据库的格式选择: Json"></a>💊模组数据库的格式选择: Json</h1><p>这里最开始选择的是最通用的文本文件, 语法自定义, 最终的配置文件如下:</p>
<blockquote>
<p>三暗影|1.0</p>
<p>content|role|莱希尔</p>
<p>role|icon|male|textures&#x2F;48_头像_莱希尔.png</p>
<p>role|icon|female|textures&#x2F;48_头像_莱希尔.png</p>
<p>role|portrait|male|textures&#x2F;48_立绘_莱希尔.png</p>
<p>role|portrait|female|textures&#x2F;48_立绘_莱希尔.png</p>
</blockquote>
<p>这种自定义语法的优点是非常直观, 模组作者一看就懂, 我只要说明有哪些字段可用即可</p>
<p>但是问题就是想要支持任何一个修改点都需要我编写代码, 比如上面的示例便是支持修改角色的立绘和头像, 仅仅这一个修改点就要写一个类, 那无论是职业, 角色, 道具, 地图, 关卡, 关卡事件, 关卡事件的条件, 关卡事件的行为, 音乐, 技能等等, 每一个模块中都有十几甚至几十个数据点, 如果每个数据点都要编写代码来给模组作者提供支持, 这个任务量可想而知, 于是此方案废弃</p>
<p>之后开始选择更加成熟的语法文件, 最终在大量的语法文件中选择了 json 文件, 其他的像 xml, ini, yaml 等都或多或少存在一些问题, 同时 json 也是我最熟悉, 最喜欢的格式, 因为它既兼顾了可读性, 又有极强的规范性, 且非常成熟, 各大编辑器都支持 json 文件, 更重要的是 Unity 唯一支持的序列化就是 json, Unity 提供的 JsonUtility 类是目前已知效率最高的 json 序列化器, 不使用的话真的是有点暴殄天物, 所以 json 成为了不二之选</p>
<p>什么 ? 你说 Unity 的 JsonUtility 兼容性不行 ? 那是你不会用, 经过我扩展的 JsonUtility 目前已经没有不支持的类型了, 再说除了 Unity 的 JsonUtility 你还知道哪个 Json 序列化器原生支持序列化 Unity 的专有类型呢 ?</p>
<p>当然还有最最最重要的一点, 那就是 <code>支持配置数据的局部修改</code></p>
<p>Unity 的 JsonUtility 有一个极方便的方法: <code>FromJsonOverwrite</code> 使用此方法便可以允许模组作者编写 Json 文件时, 仅需要编写要修改的字段, 如果字段不需要修改, 那就不需要书写, Unity 会自动使用原数值, 大大提升了模组作者的开发效率</p>
<p>比如我只想修改物品的价格, 那么只要填写 id 和 price 两个字段即可, 其他的字段完全不需要, 就是如此简单, 仅 2 行就写完了一个物品</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;core.item.001.飞刀&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="number">400</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h1 id="🍓实现资源模块的过程"><a href="#🍓实现资源模块的过程" class="headerlink" title="🍓实现资源模块的过程"></a>🍓实现资源模块的过程</h1><p>接下来阐述资源模块的实现过程, 包括游戏本体的处理和模组部分的处理</p>
<h2 id="本体-编写数据库管理系统"><a href="#本体-编写数据库管理系统" class="headerlink" title="本体: 编写数据库管理系统"></a>本体: 编写数据库管理系统</h2><p>游戏本体的数据库管理系统只需要满足一个最重要的需求即可: <strong>热重载</strong>, 即可以在运行时重置数据库数据, 并重新加载数据库</p>
<p>因为模组在开启后, 是可以被玩家关闭的, 那么此时就需要重置数据库, 或者重新加载数据库, 不能让已关闭的模组中的数据污染数据库</p>
<p>如何实现数据库的热重载呢 ?</p>
<h3 id="数据库统合管理器"><a href="#数据库统合管理器" class="headerlink" title="数据库统合管理器"></a>数据库统合管理器</h3><p>第一步, 编写数据库管理器, 用于统合每一个小的数据库, 同时提供全局的加载方法</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">loadTaskList.Add(SO_Affix.Collect(labelReference));</span><br><span class="line">loadTaskList.Add(SO_AudioClip.Collect(labelReference));</span><br><span class="line">loadTaskList.Add(SO_Bonus.Collect(labelReference));</span><br><span class="line">loadTaskList.Add(SO_Equip.Collect(labelReference));</span><br><span class="line">loadTaskList.Add(SO_GameMode.Collect(labelReference));</span><br><span class="line">loadTaskList.Add(SO_Item.Collect(labelReference));</span><br><span class="line">loadTaskList.Add(SO_Job.Collect(labelReference));</span><br><span class="line">loadTaskList.Add(SO_Level.Collect(labelReference));</span><br><span class="line">loadTaskList.Add(SO_Map.Collect(labelReference));</span><br><span class="line">loadTaskList.Add(SO_Role.Collect(labelReference));</span><br><span class="line">loadTaskList.Add(SO_Skill.Collect(labelReference));</span><br><span class="line">loadTaskList.Add(SO_Tile.CollectCastle(labelReference));</span><br></pre></td></tr></table></figure>

<h3 id="颗粒数据库的加载逻辑"><a href="#颗粒数据库的加载逻辑" class="headerlink" title="颗粒数据库的加载逻辑"></a>颗粒数据库的加载逻辑</h3><p>第二步, 编写每一个小数据库的加载逻辑, 我这里使用的是 Unity 提供的 Addressable 系统</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Dictionary&lt;<span class="built_in">string</span>, SO_Item&gt; DB &#123; <span class="keyword">get</span>; &#125; = <span class="keyword">new</span> Dictionary&lt;<span class="built_in">string</span>, SO_Item&gt;();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Task <span class="title">Collect</span>(<span class="params">AssetLabelReference labelReference</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    DB.Clear();</span><br><span class="line">    labelReference.labelString = <span class="keyword">nameof</span>(SO_Item);</span><br><span class="line">    <span class="keyword">return</span> Addressables.LoadAssetsAsync&lt;SO_Item&gt;(labelReference, LoadAsset).Task;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">LoadAsset</span>(<span class="params">SO_Item asset</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    DB[asset.id] = Instantiate(asset);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里有一个非常非常非常重要的点: <code>DB[asset.id] = Instantiate(asset);</code></p>
<p>这里为什么不能直接保存读取的 <code>asset</code> 而是要 <code>Instantiate(asset)</code> 呢? 这是因为 Unity 引擎中, ScriptableObject 的数值一旦被修改, 必须关闭游戏再次启动才能将数据还原, 因此一旦直接保存了 asset, 后面加载模组数据时, 有的模组修改了其中的数据, 那么这份数据就被永久修改了, 即使是重新加载这份资源, 也还是修改后的数值, 除非关闭游戏</p>
<p>但是每次进行模组的切换肯定不能让玩家重启游戏, 因此这里必须实例化一份新的资源, 游戏仅使用新实例化出来的副本, 而不是使用原数据, 只要注意好这点, 本体的数据库管理就完成了!</p>
<h2 id="本地-拆分数据结构"><a href="#本地-拆分数据结构" class="headerlink" title="本地: 拆分数据结构"></a>本地: 拆分数据结构</h2><p>什么是拆分数据结构 ? 要怎么拆 ? 为什么要拆 ?</p>
<p>拆分数据结构就是把要开放给模组作者的字段和不开放给模组作者的字段拆开, 因为我的项目是直接使用的 ScriptableObject 文件, 因此数据类中包含 Sprite, AudioClip 这种资源字段, 而这些字段是不能直接开放给模组作者的, 模组作者使用的字段应该是 string, 即资源的路径, 因此需要这样拆分开数据类</p>
<p>看看下面的 3 个类, 应该一下子就明白了吧, 真正要开放给模组作者的便是 <code>DatabaseItem</code> 类</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">SO_Item_Base</span> : <span class="title">ScriptableObject</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> id;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> displayName;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">SO_Item</span> : <span class="title">SO_Item_Base</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> Sprite icon;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">DatabaseItem</span> : <span class="title">SO_Item_Base</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> iconPath;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="本地-资源标识规范化"><a href="#本地-资源标识规范化" class="headerlink" title="本地: 资源标识规范化"></a>本地: 资源标识规范化</h2><p>游戏内资源的标识有几种方案选择</p>
<h3 id="枚举"><a href="#枚举" class="headerlink" title="枚举"></a>枚举</h3><p>枚举方案, 即硬编码方案, 将数据直接硬编码到程序中, 优点显而易见, 标识绝对不会出错, 一旦出错, 编译都无法通过, 缺点也是致命的, 无法运行时动态增删, 对于模组支持而言是致命的, 此方案舍弃</p>
<h3 id="数字"><a href="#数字" class="headerlink" title="数字"></a>数字</h3><p>数字方案, 比较常用的方案, 每一个资源都有自己的数字标识, 可以动态增删, 但是对于模组支持而言也有致命缺陷: 标识冲突</p>
<p>因为使用数字标识, 那么模组中新增的资源也必须使用数字标识, 这样的话, 模组作者之间的标识冲突便成为了必然, 毕竟谁也没有规定谁必须使用哪个范围内的数字, 我用了 100 - 200, 他也可以用 100 - 200, 这种冲突完全不可控, 此方案舍弃</p>
<h3 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h3><p>在前两个方案都无法满足的情况下, 就只能使用字符串了, 但是字符串作为标识也不能随便使用, 而是必须要有规范, 即使用: <code>语义字符串</code></p>
<h3 id="语义字符串"><a href="#语义字符串" class="headerlink" title="语义字符串"></a>语义字符串</h3><p>语义字符串即字符串是有语义的, 我直接以我项目中的标识来讲解, 举例两个目前使用的标识</p>
<p>这个是本体中资源的标识: <code>core.role.001.kirito</code></p>
<p>这个是模组中资源的标识: <code>mod.kuroha.role.001.asuna</code></p>
<ol>
<li>第一组语义为本体还是模组, 本体统一使用 core, 模组则统一要求作者们使用 mod</li>
<li>第二组语义为模组作者的名字, 此语义仅模组使用, 游戏本体省略</li>
<li>第三组语义为资源类型, 这里举例为 role</li>
<li>第四组语义为资源序号, 这里举例为 001</li>
<li>第五组语义为资源名称, 这里举例为 kirito 和 asuna</li>
</ol>
<p>通过这样的语义标识可以彻底避免游戏本体和模组作者以及各个模组作者之间的标识冲突问题 </p>
<h2 id="模组-添加语法文件解析"><a href="#模组-添加语法文件解析" class="headerlink" title="模组: 添加语法文件解析"></a>模组: 添加语法文件解析</h2><p>这个步骤非常简单, 目标就是读取模组的 json 文件并解析为对应的资源, 核心点就是利用 <code>FromJsonOverwrite</code> 方法实现部分配置的修改, 下面是我的模组数据结构</p>
<p><img data-src="/images/unity/mod_data.png" alt="模组数据结构"></p>
<p>最重要的点就是让模组的作者配置好 json 所代表的数据类型, 这样我们在解析时就可以按照对应的标识解析为对应的数据类型了, 以关卡数据结构为例, 整个的解析方法就这么几行, 非常简单:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">DatabaseLevel_Parser</span> : <span class="title">IParser</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> SO_Level coreAsset;</span><br><span class="line">    <span class="keyword">private</span> SO_Level newAsset;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">IsMatch</span>(<span class="params">ModContent content</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        coreAsset = <span class="literal">null</span>;</span><br><span class="line">        newAsset = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">return</span> content.type == <span class="string">&quot;database_level&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">IsCoreAsset</span>(<span class="params"><span class="built_in">string</span> jsonText</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        newAsset = UnityEngine.ScriptableObject.CreateInstance&lt;SO_Level&gt;();</span><br><span class="line">        UnityEngine.JsonUtility.FromJsonOverwrite(jsonText, newAsset);</span><br><span class="line">        <span class="keyword">return</span> SO_Level.DB.TryGetValue(newAsset.id, <span class="keyword">out</span> coreAsset);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Task <span class="title">Parse</span>(<span class="params"><span class="built_in">string</span> jsonText</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (IsCoreAsset(jsonText))</span><br><span class="line">        &#123;</span><br><span class="line">            UnityEngine.JsonUtility.FromJsonOverwrite(jsonText, coreAsset);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            SO_Level.DB[newAsset.id] = newAsset;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Task.CompletedTask;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="模组-添加图片和音乐外部加载支持"><a href="#模组-添加图片和音乐外部加载支持" class="headerlink" title="模组: 添加图片和音乐外部加载支持"></a>模组: 添加图片和音乐外部加载支持</h2><p>模组中支持模组作者自己添加精灵图和音乐, 自然需要对应的代码支持, 这个我不再废话什么了, 直接上代码</p>
<h3 id="导入图片支持"><a href="#导入图片支持" class="headerlink" title="导入图片支持"></a>导入图片支持</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> texture = <span class="keyword">new</span> Texture2D(<span class="number">2</span>, <span class="number">2</span>, TextureFormat.RGBA32, <span class="literal">false</span>);</span><br><span class="line">texture.LoadImage(<span class="keyword">await</span> File.ReadAllBytesAsync(texturePath));</span><br><span class="line">texture.Apply();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> rect = <span class="keyword">new</span> Rect(<span class="number">0</span>, <span class="number">0</span>, texture.width, texture.height);</span><br><span class="line"><span class="keyword">var</span> pivot = <span class="keyword">new</span> Vector2(<span class="number">0.5f</span>, <span class="number">0.5f</span>);</span><br><span class="line"><span class="keyword">var</span> sprite = Sprite.Create(texture, rect, pivot);</span><br></pre></td></tr></table></figure>

<h3 id="导入音频支持"><a href="#导入音频支持" class="headerlink" title="导入音频支持"></a>导入音频支持</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> URI = <span class="string">$&quot;file://<span class="subst">&#123;audioPath&#125;</span>&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> (<span class="keyword">var</span> assetRequest = UnityEngine.Networking.UnityWebRequestMultimedia.GetAudioClip(URI, audioType))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">await</span> assetRequest.SendWebRequest();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (assetRequest.result == UnityEngine.Networking.UnityWebRequest.Result.Success)</span><br><span class="line">    &#123;</span><br><span class="line">        audioCache.Add(subPath, UnityEngine.Networking.DownloadHandlerAudioClip.GetContent(assetRequest));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="🍉为游戏添加-编程模组-支持"><a href="#🍉为游戏添加-编程模组-支持" class="headerlink" title="🍉为游戏添加 &quot;编程模组&quot; 支持"></a>🍉为游戏添加 &quot;编程模组&quot; 支持</h1><p>添加模组支持主要分两部分, 一部分是如何给予模组作者一个可编译, 可编写, 可生成的编程环境, 让模组作者可以直接引用项目中的 API, 另一部分是如何加载模组作者的 DLL, 将模组作者的逻辑注入到自己的逻辑中</p>
<p>这里不考虑非 C# 语言, 因此下文中默认模组作者编写的逻辑最终会生成 DLL 文件</p>
<h2 id="如何加载模组作者-DLL-中的逻辑"><a href="#如何加载模组作者-DLL-中的逻辑" class="headerlink" title="如何加载模组作者 DLL 中的逻辑"></a>如何加载模组作者 DLL 中的逻辑</h2><p>先来说比较简单的第二部分, 因为使用的是 DLL 文件, 因此最终的加载肯定是使用 <code>Assembly.Load</code> 函数, 但是众所周知, 选择使用 Mono 时, 可以直接使用此函数, 但是当选择 IL2CPP 时, 项目是不支持上面的函数的, 所以这里必须使用 <code>HybridCLR</code> 插件, 使用此插件后便可以使用 <code>Assembly.Load</code> 了, 关于如何使用  <code>HybridCLR</code> 插件, 我就不赘述了, 因为官方文档实在是太详细了, 完全没有需要补充的点, 这里直接发出链接, 照着教程走, 几分钟就搞定了! 当然前提是你有优雅的代码管理习惯, 不然, 可能项目要大改!</p>
<p><span class="exturl" data-url="aHR0cHM6Ly9oeWJyaWRjbHIuZG9jLmNvZGUtcGhpbG9zb3BoeS5jb20v">HybridCLR 官网<i class="fa fa-external-link-alt"></i></span></p>
<p><span class="exturl" data-url="aHR0cHM6Ly9oeWJyaWRjbHIuZG9jLmNvZGUtcGhpbG9zb3BoeS5jb20vZG9jcy9pbnRybw==">HybridCLR 官方手册<i class="fa fa-external-link-alt"></i></span></p>
<h3 id="json-方案"><a href="#json-方案" class="headerlink" title="json 方案"></a>json 方案</h3><p>最简单的方案是和前面的资源模块一样, 让模组作者把 DLL 中类的全名, 全名就是包含命名空间名, 以及类的功能类别配置到 json 中, 只要知道了类的全名和功能类别, 我们就可以加载对应的类, 并将其注入到对应的功能模块中, 简单可行!</p>
<h3 id="反射方案"><a href="#反射方案" class="headerlink" title="反射方案"></a>反射方案</h3><p>自行反射实现了对应接口的类, 之后将这些类直接注入到功能模块中, 更加简单直接, 对模组作者非常友好, 不需要模组作者自行配置, 可行!</p>
<h3 id="特性方案"><a href="#特性方案" class="headerlink" title="特性方案"></a>特性方案</h3><p>提供多个特性, 让模组作者可以对自己编写的类进行修饰, 简明易读, 之后我们反射对应的特性, 将类注册到对应的功能模块中, 可行!</p>
<p>上述三种方案均可实现逻辑注入, 可自行选择方案</p>
<h3 id="必须实现的逻辑"><a href="#必须实现的逻辑" class="headerlink" title="必须实现的逻辑"></a>必须实现的逻辑</h3><p>目前我认为, 除了按照项目特点开放出来一些接口, 以供模组作者实现以外, 还有一个必须实现的功能就是 MonoBehaviour 脚本的编写, 允许模组作者自行编写 MonoBehaviour, 使用 Unity 的生命周期实现任意的自定义逻辑</p>
<p>但是这样会有问题, 就是可能会触及到敏感代码, 如果项目中确实有敏感代码, 千万不能开放 MonoBehaviour, 相反便建议支持 MonoBehaviour, 毕竟这是最高自由度的编码, 下面放一段简单的逻辑注入代码</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> modAssembly = Assembly.Load(File.ReadAllBytes(Path.Combine(Global.MOD.currentModFolder, modData.jsonPath)));</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> type <span class="keyword">in</span> modAssembly.GetTypes())</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (type.IsDefined(<span class="keyword">typeof</span>(Mod_SkillAttribute), <span class="literal">false</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        SkillRegister(type);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (type.IsDefined(<span class="keyword">typeof</span>(Mod_AffixAttribute), <span class="literal">false</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        AffixRegister(type);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (type.IsDefined(<span class="keyword">typeof</span>(Mod_MonoBehaviourAttribute), <span class="literal">false</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        MonoRegister(type);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">MonoRegister</span>(<span class="params">Type type</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> monoName = type.Name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (Global.MOD.modMonoBehaviourTable.TryGetValue(monoName, <span class="keyword">out</span> <span class="keyword">var</span> mono))</span><br><span class="line">    &#123;</span><br><span class="line">        DebugUtil.LogWarning(<span class="string">$&quot;已存在类型: <span class="subst">&#123;mono&#125;</span>&quot;</span>, DebugUtil.YELLOW);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> monoGameObject = <span class="keyword">new</span> GameObject(monoName);</span><br><span class="line">    monoGameObject.transform.SetParent(Global.MOD.modMonoBehaviourRoot.transform);</span><br><span class="line">    Global.MOD.modMonoBehaviourTable[monoName] = monoGameObject.AddComponent(type) <span class="keyword">as</span> MonoBehaviour;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">AffixRegister</span>(<span class="params">Type type</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    Global.AFFIX.RegisterLogic(Activator.CreateInstance(type) <span class="keyword">as</span> Affix);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">SkillRegister</span>(<span class="params">Type type</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    Global.SKILL.RegisterLogic(Activator.CreateInstance(type) <span class="keyword">as</span> Skill);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="如何给予模组作者-DLL-开发环境"><a href="#如何给予模组作者-DLL-开发环境" class="headerlink" title="如何给予模组作者 DLL 开发环境"></a>如何给予模组作者 DLL 开发环境</h2><p>这里就是本文的重中之重了, 如何给予模组作者一个可编码, 可编译, 可生成的游戏开发环境, 就像 Unity 给我们开发者提供了开发环境一样, 我们也要给模组作者提供开发环境</p>
<p>提供开发环境的意思就是, 模组作者可以直接调用我们项目中的代码, 可以直接编译通过, 生成 DLL 文件, 那么我们就需要把代码开放出来, 对吧 ?</p>
<blockquote>
<p>啊 ? 这对吗 ? 这不对吧 ? 把代码开放出来 ? 你 TM 在开玩笑吗 ? 你干脆让我开源算了 ...</p>
<p>好事做到底, 直接开放项目, 让他们可以重打包, 发布游戏赚钱, 我直接成为别人的打工人算了 ... 岂不美哉 ?</p>
</blockquote>
<p>哈哈哈, 冷静, 冷静 ... 听我慢慢说 ... </p>
<p>因为 C# 是编译型语言, 所以想要让模组作者可编码, 可编译, 可生成, 提供游戏内的基础库是必须的, 不然他们根本无法编码, 但是我们也不能暴露自己的代码实现呀, 毕竟 DLL 发出来就和代码裸奔没什么区别, 那么有什么办法既可以满足模组作者的需要, 又可以满足我们开发者的需要呢 ?</p>
<p>有, 有的, 兄弟!</p>
<p>那就是声明式程序集</p>
<h2 id="声明式程序集"><a href="#声明式程序集" class="headerlink" title="声明式程序集"></a>声明式程序集</h2><p>声明式程序集中仅包含声明, 没有任何的实现, 也就是说这个 DLL 仅能用来辅助编译, 无法被加载, 被识别, 因为里面是空的, 只有一堆声明信息, 这样就满足双方的需求了!</p>
<p>那么:</p>
<ol>
<li>如何生成声明式程序集呢 ? </li>
<li>生成声明式程序集时要注意什么呢 ? </li>
<li>无法被加载又是什么意思, 会有哪些坑呢 ?</li>
</ol>
<h2 id="如何生成声明式程序集"><a href="#如何生成声明式程序集" class="headerlink" title="如何生成声明式程序集"></a>如何生成声明式程序集</h2><p>声明式程序集其实就是 &quot;类库&quot; 类型项目的构建结果</p>
<p>回想下最初学习编程时, 是不是面对一个黑窗口 (cmd) 来查看编程结果, 那种项目便是控制台类型项目, 最终的构建结果是一个 exe 文件, 而这里的声明式程序集就是一个 &quot;类库&quot; 型的项目, 最终的构建结果是 DLL 文件</p>
<p>我用 Rider 打开类库项目, 尝试生成声明式程序集, 发现并不行, 只能生成完整程序集, 于是目前为止, 我所知道的能够一键生成声明式程序集的软件就是 <code>Visual Studio</code></p>
<p>为什么不说 <code>VS Code</code> 呢, 因为这个软件需要手动配置, 并不是一键生成, 对新手并不友好, 也就是对我不友好, 同时 Unity 想要打包 IL2CPP 的话, 需要安装 C++ 编译器, 还需要安装 Windows 10 SDK, 如果仅使用 <code>VS Code</code> , 那么这些环境都是需要自己手动去折腾的</p>
<p>于是统合上述全部需求, 既可以一键管理开发环境, 一键管理编译器, 一键管理 Windows SDK 的安装卸载, 又可以编译生成声明式程序集的 <code>Visual Studio</code> 自然成为了首选</p>
<p>接下来我会以自己项目为例, 一步一步讲述如果构建自己游戏的 SDK</p>
<h2 id="声明式程序集生成步骤"><a href="#声明式程序集生成步骤" class="headerlink" title="声明式程序集生成步骤"></a>声明式程序集生成步骤</h2><h3 id="安装开发环境"><a href="#安装开发环境" class="headerlink" title="安装开发环境"></a>安装开发环境</h3><p>在 <code>Visual Studio Instanller</code> 中安装 <code>.Net 桌面开发</code> 组件, 仅安装基础组件即可, 其它的附加组件其实都不需要, 当然安装了也不是不行</p>
<h3 id="新建解决方案"><a href="#新建解决方案" class="headerlink" title="新建解决方案"></a>新建解决方案</h3><p>启动 Visual Studio 2022 , 选择<strong>创建新项目</strong></p>
<p><img data-src="/images/unity/mod-sdk-0.png" alt="新建解决方案3"></p>
<p>选择 &quot;类库&quot; 类型, 注意项目图标右上方的语言标识, 记得选择 C# 的, 不要选择了 VB 或者 F# 的</p>
<p><img data-src="/images/unity/mod-sdk-1.png" alt="新建解决方案1"></p>
<p>填写名称, 选择项目目录</p>
<p><img data-src="/images/unity/mod-sdk-2.png" alt="新建解决方案2"></p>
<p>框架选择 <code>.Net Standard 2.1</code></p>
<p>其实选择 <code>.Net Standard 2.0</code> 应该也可以, 不过我没试过</p>
<p><img data-src="/images/unity/mod-sdk-3.png" alt="新建解决方案3"></p>
<h3 id="删除默认项目"><a href="#删除默认项目" class="headerlink" title="删除默认项目"></a>删除默认项目</h3><p>删除解决方案中的默认项目, 右键项目, 在菜单中选择移除</p>
<p>移除后, 项目所以不再属于此解决方案中, 但是项目本身的文件还在存在于磁盘中的, 建议找到目录中的项目文件, 也一并删除</p>
<p><img data-src="/images/unity/mod-sdk-4.png" alt="新建解决方案4"></p>
<h3 id="新建-Unity-项目"><a href="#新建-Unity-项目" class="headerlink" title="新建 Unity 项目"></a>新建 Unity 项目</h3><p>按照 Unity 项目中程序集的划分来建立项目, 比如我的项目中划分的运行时项目有 7 个, 那么就需要新建 7 个项目, 在解决方案菜单上右键, 选择添加, 新建项目, 只有和游戏运行相关的需要在这里参与编译, 生成声明式程序集, 其他不参与的编辑器程序集则不需要新建</p>
<p><img data-src="/images/unity/mod-sdk-5.png" alt="新建解决方案5"></p>
<p>填入在 Unity 中填写的程序集名称, 比如和 Unity 中的保持一致, 至于为什么, 我最后解释, 这里先这么做</p>
<p>新建项目后, 记得把项目中默认的 <code>Class1.cs</code> 删除, 因为我们不需要编写额外代码, 到时候直接把项目代码拷贝过来就可以了</p>
<p>我的项目中划分的运行时项目有 7 个</p>
<ul>
<li>ARModule</li>
<li>Kuroha.PNG</li>
<li>Kuroha.GIF</li>
<li>Kuroha.KConsole.Runtime</li>
<li>Kuroha.UI.Runtime</li>
<li>Kuroha.Utility.Runtime</li>
<li>SwordRequiem.Runtime</li>
</ul>
<p>全部项目新建完成后截图如下</p>
<p><img data-src="/images/unity/mod-sdk-6.png" alt="新建解决方案6"></p>
<h3 id="将-Unity-中的代码拷贝到对应的项目中"><a href="#将-Unity-中的代码拷贝到对应的项目中" class="headerlink" title="将 Unity 中的代码拷贝到对应的项目中"></a>将 Unity 中的代码拷贝到对应的项目中</h3><p>将 Unity 中的代码拷贝到相对应的项目中, 如果你会使用 Windows 软链接, 可以使用软链接直接同步过去, 当然此时项目中将会有大量的报错, 没关系, 这是因为没有引用相关的 Unity 程序集导致的, 代码拷贝完成后的截图如下</p>
<p><img data-src="/images/unity/mod-sdk-7.png" alt="新建解决方案7"></p>
<h3 id="引入依赖的-Unity-类库和第三方插件库"><a href="#引入依赖的-Unity-类库和第三方插件库" class="headerlink" title="引入依赖的 Unity 类库和第三方插件库"></a>引入依赖的 Unity 类库和第三方插件库</h3><p>下一步就是解决对 Unity 类库和第三方插件库的依赖问题, 解决原理就是直接让 Unity 打一次包就可以了, Unity 打包后生成的 DLL 肯定是全的, 不然游戏运行不起来呀, 对吧 ?</p>
<blockquote>
<p>如果你的项目是 <code>Mono</code> 项目, 则直接打一个包, 打包后程序的 <code>Managed</code> 文件夹中会生成项目全部的 DLL 文件, 将这些文件拷贝到一个特定的目录, 让  <code>SDK</code> 解决方案中的每一个项目都去引用他们即可, 需要注意, 千万不要一股脑全选引用, 因为很多是重复引用, 是不能添加的, 按照你项目自己的报错信息添加依赖的 DLL 即可</p>
</blockquote>
<blockquote>
<p>如果你的项目是 <code>IL2CPP</code> 项目怎么办呢 ? 不用担心, 使用 <code>HybridCLR</code> 插件后, 执行 <code>HybridCLR/Generate/All</code> 菜单, 生成后, 在 <code>HybridCLRData/AssembliesPostIl2CppStrip</code> 文件夹中可以找到全部的 DLL 文件, 将这些文件拷贝到一个特定的目录, 让 <code>SDK</code> 解决方案中的每一个项目都去引用他们即可, 需要注意, 千万不要一股脑全选引用, 因为很多是重复引用, 是不能添加的, 按照你项目自己的报错信息添加依赖的 DLL 即可, 当然你也可以暂时切换回 Mono 模式打包获取 DLL 后再切换回来</p>
</blockquote>
<p>在项目的 <strong>依赖项</strong> 上右键, 选择 &quot;添加项目引用&quot;</p>
<p><img data-src="/images/unity/mod-sdk-8.png" alt="新建解决方案8"></p>
<p>点击右下角的 &quot;浏览&quot; 添加对应的引用即可</p>
<p><img data-src="/images/unity/mod-sdk-9.png" alt="新建解决方案9"></p>
<h3 id="解决项目间的依赖问题"><a href="#解决项目间的依赖问题" class="headerlink" title="解决项目间的依赖问题"></a>解决项目间的依赖问题</h3><p>这个就更简单了, 同样是在项目的 <strong>依赖项</strong> 上右键, 选择 &quot;添加项目引用&quot;, 不过在打开的页面中选择解决方案, 直接在列出的已有项目中选择依赖的项目即可</p>
<p><img data-src="/images/unity/mod-sdk-10.png" alt="新建解决方案10"></p>
<p><code>注: 因为逐个项目修改引用很慢, 如果知道怎么修改 .csproj 文件, 你可以直接编辑 .csproj 文件, 实现以超快速度设定完成项目引用!</code></p>
<h3 id="设定语言版本"><a href="#设定语言版本" class="headerlink" title="设定语言版本"></a>设定语言版本</h3><p>至此应该会是会有很多报错, 比如使用了高版本的语言特性, 所以我们需要设定一下编译时的语言版本, 由于语言版本无法在 &quot;属性&quot; 中修改, 所以需要直接编辑 csproj 文件, 双击项目就可以打开 csproj 文件了, 在 <code>PropertyGroup</code> 标签内添加一行, 注意, 每一个项目的 csproj 文件都要修改!</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">LangVersion</span>&gt;</span>latest<span class="tag">&lt;/<span class="name">LangVersion</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="设定生成声明式程序集"><a href="#设定生成声明式程序集" class="headerlink" title="设定生成声明式程序集"></a>设定生成声明式程序集</h3><p>默认情况下类库项目仅生成完整的 DLL. 如果要生成声明式程序集 DLL 需要编辑 csproj 文件, 在 <code>PropertyGroup</code> 标签内添加一行, 注意, 每一个项目的 csproj 文件都要修改!</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ProduceReferenceAssembly</span>&gt;</span>true<span class="tag">&lt;/<span class="name">ProduceReferenceAssembly</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="设定生成声明式程序集的输出目录"><a href="#设定生成声明式程序集的输出目录" class="headerlink" title="设定生成声明式程序集的输出目录"></a>设定生成声明式程序集的输出目录</h3><p>默认情况下声明式程序集 DLL 会生成到各自项目的 obj 文件夹中, 为了方便拷贝, 可以统一生成到一个目录下, 要修改输出目录首先要启用自定义输出目录, 之后配置输出目录, 同样是编辑 csproj 文件, 在 <code>PropertyGroup</code> 标签内添加两行, 注意, 每一个项目的 csproj 文件都要修改!</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">BaseOutputPath</span>&gt;</span>..\..\SwordRequiemDLL<span class="tag">&lt;/<span class="name">BaseOutputPath</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ProduceReferenceAssemblyInOutDir</span>&gt;</span>true<span class="tag">&lt;/<span class="name">ProduceReferenceAssemblyInOutDir</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>到目前为止, csproj 文件的 <code>PropertyGroup</code> 标签大概是这样:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">PropertyGroup</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">TargetFramework</span>&gt;</span>netstandard2.1<span class="tag">&lt;/<span class="name">TargetFramework</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">Nullable</span>&gt;</span>enable<span class="tag">&lt;/<span class="name">Nullable</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">LangVersion</span>&gt;</span>latest<span class="tag">&lt;/<span class="name">LangVersion</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">BaseOutputPath</span>&gt;</span>..\..\SwordRequiemDLL<span class="tag">&lt;/<span class="name">BaseOutputPath</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">ProduceReferenceAssembly</span>&gt;</span>true<span class="tag">&lt;/<span class="name">ProduceReferenceAssembly</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">ProduceReferenceAssemblyInOutDir</span>&gt;</span>true<span class="tag">&lt;/<span class="name">ProduceReferenceAssemblyInOutDir</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">PropertyGroup</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="补充编译宏"><a href="#补充编译宏" class="headerlink" title="补充编译宏"></a>补充编译宏</h3><p>虽然已经添加了绝大多数设置和引用了, 但是到这里的时候, 项目应该还是报错的, 无法生成</p>
<p>这是因为 Unity 中我们一般是多平台开发的, 里面有很多宏控制, 区分不同平台</p>
<p>尤其是接入了 Steam 时, 还有 Steam 的宏控制, 因此需要设定一下宏, 那这里的宏究竟要添加哪些呢 ?</p>
<p>这个是按照自己的项目来的, 前面不是打包了一次吗 ? 为了生成 DLL 的时候, 就使用那个项目那时的宏状态, 打包的时候用了什么宏, 这里就要写入什么宏</p>
<p>项目处右键, 打开属性, 找到 <code>条件编译符号</code> 添加对应的宏即可</p>
<p><img data-src="/images/unity/mod-sdk-11.png" alt="新建解决方案11"></p>
<p>最后点击 <code>生成/重新生成解决方案</code> 即可生成声明式 DLL, 可以在输出目录的 <code>ref</code> 文件夹中找到</p>
<p><img data-src="/images/unity/mod-sdk-12.png" alt="新建解决方案12"></p>
<p>这些 DLL 就可以发给模组作者了</p>
<p>前面不是让你把需要引用的 DLL 全部单独放到一个文件夹里面嘛, 这里最好是连前面引用的文件夹中的 DLL 一起发给模组作者, 这样我们游戏的 SDK 环境就完整了!</p>
<p>这样模组作者就可以通过新建类库项目, 引用我们给的 DLL 文件, 就可以编写代码了!</p>
<h1 id="⚡为什么要和-Unity-中的程序集划分保持一致"><a href="#⚡为什么要和-Unity-中的程序集划分保持一致" class="headerlink" title="⚡为什么要和 Unity 中的程序集划分保持一致 ?"></a>⚡为什么要和 Unity 中的程序集划分保持一致 ?</h1><p>以我自己的项目为例, 我在 Unity 项目中划分了 7 个程序集: </p>
<ul>
<li>ARModule</li>
<li>Kuroha.PNG</li>
<li>Kuroha.GIF</li>
<li>Kuroha.KConsole.Runtime</li>
<li>Kuroha.UI.Runtime</li>
<li>Kuroha.Utility.Runtime</li>
<li>SwordRequiem.Runtime</li>
</ul>
<p>现在, 我的 SDK 项目 (用于为 Mod 作者生成声明式程序集的项目) 中只划分了一个程序集: <code>SwordRequiem.SDK</code></p>
<p>我生成声明式程序集, 得到一个 <code>SwordRequiem.SDK.dll</code> 并将它发给 Mod 作者, Mod 作者在这个环境中编写逻辑, 编译得到 <code>mod.dll</code></p>
<p>其中 <code>mod.dll</code> 依赖于 <code>SwordRequiem.SDK.dll</code></p>
<p>然而, 当游戏尝试在运行时加载这个 <code>mod.dll</code> 时, 会直接报错: <code>无法找到名为 SwordRequiem.SDK 的程序集</code> 提示缺失引用！</p>
<h2 id="尝试解决下"><a href="#尝试解决下" class="headerlink" title="尝试解决下 ?"></a>尝试解决下 ?</h2><p>我们可以设想, 是否可以把 <code>SwordRequiem.SDK.dll</code> 一并保留, 运行时在加载 <code>mod.dll</code> 之前, 先手动加载这个 SDK DLL ?</p>
<p>理论上可以, 但实际上不行 -- 这就是声明式程序集的局限: </p>
<blockquote>
<p>声明式程序集中只包含类型的声明, 而不包含任何逻辑实现也就是说它只适用于编译期引用, 而在运行时根本无法被加载</p>
</blockquote>
<p>当你尝试在运行时使用 <code>Assembly.LoadFrom(&quot;SwordRequiem.SDK.dll&quot;)</code> 加载它时, CLR 会直接报错, 提示这是一个非法程序集, 通常为 <code>BadImageFormatException</code></p>
<h2 id="那怎么办"><a href="#那怎么办" class="headerlink" title="那怎么办 ?"></a>那怎么办 ?</h2><p>我们再来看看 CLR 如何判断程序集引用: </p>
<p>程序集的识别是基于 <code>Assembly Identity</code> 它包含以下字段: </p>
<ul>
<li>Name ✅</li>
<li>Version</li>
<li>Culture</li>
<li>PublicKeyToken</li>
</ul>
<p>虽然完整规则包含版本、公钥等, 但大多数 Unity 项目未启用这些, 主要就是靠 <code>Name</code> 匹配程序集</p>
<p>✅ 正解: 保持程序集划分一致</p>
<p>如果你让声明式 SDK 的输出程序集与 Unity 的原始程序集保持一致, 那就不会有这个问题了, Mod 编译时依赖的是 <code>SwordRequiem.Runtime</code> 游戏运行时自然已经加载了真实的 <code>SwordRequiem.Runtime.dll</code>, CLR 会将 mod 中的类型引用绑定到原始实现, 无需再手动加载 SDK DLL, 如此一来, <code>mod.dll</code> 就可以毫无障碍地被加载与运行了</p>
<p>✅ 小结</p>
<p><code>Mod 编译时依赖的程序集名称必须和游戏运行时实际加载的程序集完全一致</code></p>
<p>因此, 声明式程序集必须划分为多个与 Unity 原始项目一致的模块, 不能统一为一个 SwordRequiem.SDK, 否则就会造成运行时绑定失败</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="reward-container">
  <div>请我一杯咖啡吧！</div>
  <button>
    赞赏
  </button>
  <div class="post-reward">
      <div>
        <img src="/images/about/alipay.png" alt="Kuroha 支付宝">
        <span>支付宝</span>
      </div>

  </div>
</div>

          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>Kuroha
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="https://kuroha.vip/unity/unity_mod_programming.html" title="Unity 游戏的模组支持开发总结">https://kuroha.vip/unity/unity_mod_programming.html</a>
  </li>
  <li class="post-copyright-license">
      <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC96aF9DTg=="><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</span> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

          <div class="followme">
  <span>欢迎关注我的其它发布渠道</span>

  <div class="social-list">

      <div class="social-item">
          <a target="_blank" class="social-link" href="https://t.me/KurohaKirito">
            <span class="icon">
              <i class="fab fa-telegram"></i>
            </span>

            <span class="label">Telegram</span>
          </a>
      </div>
  </div>
</div>

          <div class="post-tags">
              <a href="/tags/Mod/" rel="tag"><i class="fa fa-tag"></i> Mod</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/game/game-true-hit.html" rel="prev" title="战棋游戏命中率研究">
                  <i class="fa fa-angle-left"></i> 战棋游戏命中率研究
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/computer/computer_desk.html" rel="next" title="记录一次 U 盘损坏并成功进行数据恢复的历程">
                  记录一次 U 盘损坏并成功进行数据恢复的历程 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 2019 – 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-leaf"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Kuroha</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>站点总字数：</span>
    <span title="站点总字数">115k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">6:59</span>
  </span>
</div>

    <div id="days"></div>
    <script type="text/javascript" src="/js/website_runtime.js"></script>



    </div>
  </footer>

  
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

  <span class="exturl github-corner" data-url="aHR0cHM6Ly9naXRodWIuY29tL2t1cm9oYWtpcml0bw==" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></span>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script size="300" alpha="0.6" zIndex="-1" src="https://cdnjs.cloudflare.com/ajax/libs/ribbon.js/1.0.2/ribbon.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.28/fancybox/fancybox.umd.js" integrity="sha256-ytMJGN3toR+a84u7g7NuHm91VIR06Q41kMWDr2pq7Zo=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>




  <script src="/js/third-party/fancybox.js"></script>



  




<!--究极看板娘效果-->

    <!-- JQuery 依赖 -->
    <script type="text/javascript" src="/js/live2d_demo/jquery.js"></script>
    <!-- 实现拖动效果，需引入 JQuery UI -->
    <script type="text/javascript" src="/js/live2d_demo/jquery-ui.js"></script>
    <!-- 使用 autoload.js 引入看板娘 -->
    <script type="text/javascript" src="/js/live2d_demo/autoload.js"></script>


<!--Aplayer 吸底式音乐播放功能-->

    <link rel="stylesheet" href="/js/aplayer/APlayer.min.css">
    <div id="aplayer_fixed"></div>
    <script type="text/javascript" src="/js/aplayer/APlayer.min.js"></script>
    <script type="text/javascript" src="/js/fixedAplayer.js"></script>


<!--崩溃欺骗-->

    <script type="text/javascript" src="/js/crash_cheat.js"></script>


<!--鼠标红心效果-->


<!--烟花爆炸特效-->

    <canvas class="fireworks" style="position:fixed;left:0;top:0;z-index:99999999;pointer-events:none;"></canvas>
    <script type="text/javascript" src="/js/fireworks.js"></script>


<!--动漫菜单-->

    <div class="GalMenu GalDropDown">
        <div class="circle" id="gal">
            <div class="ring">
                <a href="/" class="menuItem">首页</a>
                <a href="javascript:history.go(1);" class="menuItem">前进</a>
                <a href="javascript:$('html,body').animate({scrollTop:0},500);" class="menuItem">顶部</a>
                <a href="javascript:location.reload();" class="menuItem">刷新</a>
                <a href="/about/" class="menuItem">留言</a>
                <a href="javascript:history.go(-1);" class="menuItem">后退</a>
            </div>
            
                <audio id="audio" src="/js/galmenu/audio/sao-menu.wav"></audio>
            
        </div>
    </div>
    <script type="text/javascript">
        var items = document.querySelectorAll('.menuItem');
        for (var i = 0, l = items.length; i < l; i++) {
            items[i].style.left = (50 - 35 * Math.cos(- 0.5 * Math.PI - 2 * (1 / l) * i * Math.PI)).toFixed(4) + "%";
            items[i].style.top = (50 + 35 * Math.sin(- 0.5 * Math.PI - 2 * (1 / l) * i * Math.PI)).toFixed(4) + "%"
        }
    </script>
    <script>
        window.jQuery || document.write('<script src="/js/galmenu/js/jquery.min.js"><\/script>')
    </script>
    <script src="/js/galmenu/js/GalMenu.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $('body').GalMenu({'menu': 'GalDropDown'})
        });
    </script>


<!--Sakana-->
<div class="sakana-box"></div>
<script src="/js/sakana/sakana.js"></script>
<script>
Sakana.init({
    el:         '.sakana-box',     // 启动元素 node 或 选择器
    scale:      0.5,               // 缩放倍数
    canSwitchCharacter: true,      // 允许换角色
});
Sakana.setMute(false);
</script>
</body>
</html>
